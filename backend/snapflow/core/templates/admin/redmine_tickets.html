{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
  <link rel="stylesheet" type="text/css" href="{% static 'css/tickets.css' %}">
{% endblock %}

{% block content %}



<form method="get" id="projet-form">
  <label for="projet">Filtrer par projet :</label>
  <select name="projet_id" id="projet" onchange="document.getElementById('projet-form').submit();">
    <option value="" {% if not selected_projet_id %}selected{% endif %}>-- Tous les projets --</option>
    {% for projet in projets %}
      <option value="{{ projet.id }}" {% if projet.id|stringformat:"s" == selected_projet_id|stringformat:"s" %}selected{% endif %}>
        {{ projet.nom }}
      </option>
    {% endfor %}
  </select>
</form>

{% if tickets %}
<table class="adminlist">
  <thead>
    <tr>
      <th>ID</th>
      <th>Projet</th>
      <th>Sujet</th>
      <th>Statut</th>
      <th>Priorité</th>
      <th>Lien</th>
    </tr>
  </thead>
  <tbody>
    {% for ticket in tickets %}
    <tr>
      <td data-label="ID">{{ ticket.id }}</td>
      <td data-label="Projet">{{ ticket.projet_nom }}</td>
      <td>{{ ticket.subject }}</td>
      <td>{{ ticket.status.name }}</td>
      <td>{{ ticket.priority.name }}</td>
      <td data-label="Lien">
        <a href="{{ ticket.url }}" target="_blank" class="ticket-link" rel="noopener noreferrer">Voir le ticket</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>Aucun ticket Redmine trouvé.</p>
{% endif %}

{% endblock %}
